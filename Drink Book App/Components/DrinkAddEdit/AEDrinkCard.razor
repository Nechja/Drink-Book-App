@attribute [Authorize(Roles = "Admin")]
@page "/drinktools/adddrink"
@page "/drinktools/editdrink"


<MudDrawer @bind-Open="@OpenGarnish" Width="60%" Anchor="Anchor.Start" Elevation="1" Variant="@DrawerVariant.Temporary">
	<Garnish></Garnish>
</MudDrawer>

<MudDrawer @bind-Open="@OpenIce" Width="60%" Anchor="Anchor.Start" Elevation="1" Variant="@DrawerVariant.Temporary">
	<Ice></Ice>
</MudDrawer> 

<MudDrawer @bind-Open="@OpenGlass" Width="60%" Anchor="Anchor.Start" Elevation="1" Variant="@DrawerVariant.Temporary">
	<AEGlassware></AEGlassware>
</MudDrawer>

<MudDrawer @bind-Open="@OpenRim" Width="60%" Anchor="Anchor.Start" Elevation="1" Variant="@DrawerVariant.Temporary">
	<Rim></Rim>
</MudDrawer>


<MudStack Spacing="2" Justify="Justify.FlexStart">
	<MudPaper Elevation="0" Width="100%" Class="start-0">
		<MudPaper Elevation="0" Class="">
			<MudText Class="d-flex ml-4 flex-grow-1">Add Instruction</MudText>
			<EditForm Model="Drink" OnValidSubmit="OnValidSubmit">
				<DataAnnotationsValidator />
				<ValidationSummary />
				<MudToolBar>

					<MudButtonGroup Variant="Variant.Outlined" Class="d-flex align-center flex-grow-1" Elevation="0">
						<MudButton ButtonType="ButtonType.Submit" Variant="Variant.Text" Size="Size.Medium">Add</MudButton>
						<MudButton ButtonType="ButtonType.Reset" Variant="Variant.Text" OnClick="@(() => Drink = new DrinkDisplayModel())" Size="Size.Medium">Reset</MudButton>
					</MudButtonGroup>
				</MudToolBar>
				@if (!String.IsNullOrEmpty(ErrorText))
				{
					<MudAlert Severity="Severity.Warning">@ErrorText</MudAlert>
				}
				<MudTextField Class="px-10" @bind-Value="Drink.Name" Label="Drink Name" />
				<MudStack Class="px-10" Row="true" Spacing="0" Justify="Justify.FlexStart">
				<MudSelect T="TagDisplayModel" @bind-Value="@Drink.Rim" Label="Rim" AnchorOrigin="Origin.BottomCenter">
					@foreach (var rim in RimTypes)
					{
						<MudSelectItem Value="rim">@rim.Value</MudSelectItem>
					}
				</MudSelect>
					<MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@(() => OpenRim = !OpenRim)" />

				</MudStack>
				<MudStack Class="px-10" Row="true" Spacing="0" Justify="Justify.FlexStart">
				<MudSelect T="TagDisplayModel" @bind-Value="@Drink.Ice" Label="Ice" AnchorOrigin="Origin.BottomCenter">
					@foreach (var ice in IceTypes)
					{
						<MudSelectItem Value="ice">@ice.Value</MudSelectItem>
					}
				</MudSelect>
				<MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@(() => OpenIce = !OpenIce)" />

				</MudStack>
				<MudPaper Elevation="0" Class="pt-3">
					<MudText Class="px-10">Garnishes<MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@(() => OpenGarnish = !OpenGarnish)" /></MudText>
					<MudChipSet Class="px-10" MultiSelection="true" @bind-SelectedChips="@Selected" Filter="true">

						@foreach (var gt in GarnishTypes)
						{
							<MudChip Value="gt" Text="@gt.Value" />
						}

					</MudChipSet>

				</MudPaper>
				<MudTextField Class="px-10 pa-4" @bind-Value="Drink.Image" Label="Image" />
				<MudStack Class="px-10" Row="true" Spacing="0" Justify="Justify.FlexStart">
				<MudSelect T="GlassDisplayModel" @bind-Value="@Drink.Glass" Label="Glassware" AnchorOrigin="Origin.BottomCenter">
					@foreach (GlassDisplayModel g in Glassware)
					{
						<MudSelectItem Value="g">@g.Name (@g.Oz)</MudSelectItem>
					}
				</MudSelect>
					<MudIconButton Icon="@Icons.Material.Filled.Add" OnClick="@(() => OpenGlass = !OpenGlass)" />

				</MudStack>
				<MudItem Class="px-8">
					<CascadingValue Value="Drink.Tags">
						<Tagging OnSelectTag="OnSelectTag"
								 TagType="@nameof(InstructionDisplayModel)"
								 EnterInterup="OnEnterStop"></Tagging>
					</CascadingValue>
				</MudItem>
			</EditForm>
			@if (Drink.Instructions.Any())
			{
				<MudPaper Elevation="0" Class="pa-4 ml-4">

					<MudText Class="pl-4">Instructions:</MudText>
				</MudPaper>
			}

			<MudPaper Square="true" Elevation="0" Class="pa-4">
				<MudStack Spacing="2" Justify="Justify.Center">
					@foreach (InstructionDisplayModel i in Drink.Instructions)
					{
						<MudPaper Elevation="1" Square="true">
							<MudStack Row="true" Justify="Justify.SpaceBetween">
								<MudPaper Elevation="0">
									<MudChip Label="true" Color="Color.Transparent" Variant="Variant.Text" Text="@i.Ingredient.Name"></MudChip>
									@if (i.Oz != null)
									{
										<MudChip Label="true" Color="Color.Transparent" Variant="Variant.Text" Text="@($"{i.Oz.Value.ToString()} oz")"></MudChip>

									}
									<MudChip Label="true" Color="Color.Transparent" Variant="Variant.Text" Text="@i.Flag.Name"></MudChip>
								</MudPaper>
								<MudButtonGroup Color="Color.Dark" Variant="Variant.Text">
									<MudIconButton Icon="@Icons.Material.Filled.Delete" aria-label="delete"></MudIconButton>
									<MudIconButton Icon="@Icons.Material.Filled.Edit" aria-label="edit"></MudIconButton>
								</MudButtonGroup>

							</MudStack>
							<MudPaper>
							</MudPaper>
						</MudPaper>

					}
				</MudStack>
			</MudPaper>
		</MudPaper>
	</MudPaper>
	<MudPaper Elevation="0">
		<CascadingValue Value="Instruction">
			<AEInstruction OnSelectInstruction="OnSelectInstructionChange"></AEInstruction>
		</CascadingValue>
	</MudPaper>
</MudStack>


